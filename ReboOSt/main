if login then

crash = true
local diskiconactiv = false
local diskXmin = nil
local diskXmax = nil
local pfolXmin = nil
local pfolXmax = nil
local dir = nil

local function Desk()
term.setCursorBlink(false)
term.setBackgroundColor(tbar)
term.clear()
term.setCursorPos (1,1)
term.setBackgroundColor(tbar)
print("                                                  ")
term.setCursorPos(1,1)
term.setTextColor(sndtxt)
write(OStag)
if rosdebug then
 term.setTextColor(colors.red)
 print(" "..devpart.." "..version)
else
 term.setTextColor(tbartxt)
 print(" "..devpart.." "..version)
end
term.setCursorPos(44,1)
term.setTextColor(prog)
write("Desktop ")
term.setBackgroundColor(mbar)
term.setTextColor(mbartxt)
paintutils.drawImage(Wallpaper,1,2)
term.setCursorPos(1,19)
term.setBackgroundColor(tbar)
term.setTextColor(tbartxt)
write(UserName)
local fslen = string.len(freeSpace)
local fsX = 49 - fslen
term.setCursorPos(fsX,19)
write(freeSpace)
term.setTextColor(sndtxt)
write(" KB")
end
if termstart then
 if rosloging then
  roslog.writeLine(shell.getRunningProgram()..": going into shell")
 end
 shell.run("/ReboOSt/shell")
 Desk()
else
 Desk()
end

while true do


if pfolder then pfolXmin = 2 pfolXmax = 6 diskXmin = 8 diskXmax = 11 else pfolXmin = 0 pfolXmax = 0 diskXmin = 2 diskXmax = 6 end

if disk.isPresent("bottom") and not disk.hasAudio("bottom") or disk.isPresent("top") and not disk.hasAudio("top") or disk.isPresent("right") and not disk.hasAudio("right") or disk.isPresent("left") and not disk.hasAudio("left") or disk.isPresent("back") and not disk.hasAudio("back") or disk.isPresent("front") and not disk.hasAudio("front") then
 paintutils.drawImage(disklogo,diskXmin,4)
 term.setCursorPos(diskXmin,8)
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 print("Disk")
 diskiconactiv = true
else
 if diskiconactiv then
  paintutils.drawImage(Background,1,2)
  term.setCursorPos(1,18)
  term.setBackgroundColor(tbar)
  term.setTextColor(tbartxt)
  print(UserName)
 else
 end
end

if pfolder then
 paintutils.drawImage(ProgFold,2,4)
 term.setCursorPos(2,8)
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 print("Prog")
end

local event, button, X, Y = os.pullEvent("mouse_click")
local XY = X..","..Y

 -- Unimnu

if X >= 1 and X <= 7 and Y == 1 then
 if rosloging then
  roslog.writeLine(shell.getRunningProgram()..": opening Unimenu")
 end
 shell.run("/ReboOSt/unimnu")
 if login then
  Desk()
 else
  break
 end

 -- Disk

elseif disk.isPresent("bottom") and not disk.hasAudio("bottom") or disk.isPresent("top") and not disk.hasAudio("top") or disk.isPresent("right") and not disk.hasAudio("right") or disk.isPresent("left") and not disk.hasAudio("left") or disk.isPresent("back") and not disk.hasAudio("back") or disk.isPresent("front") and not disk.hasAudio("front") then
 if X >= 8 and X <= 11 and Y >= 4 and Y <= 8 and button == 1 then
  if disk.isPresent("bottom") and not disk.hasAudio("bottom") then
   dir = disk.getMountPath("bottom")
   dir = dir.."/"
  elseif disk.isPresent("top") and not disk.hasAudio("top") then
   dir = disk.getMountPath("top")
   dir = dir.."/"
  elseif disk.isPresent("left") and not disk.hasAudio("left") then
   dir = disk.getMountPath("left")
   dir = dir.."/"
  elseif disk.isPresent("right") and not disk.hasAudio("right") then
   dir = disk.getMountPath("right")
   dir = dir.."/"
  elseif disk.isPresent("back") and not disk.hasAudio("back") then
   dir = disk.getMountPath("back")
   dir = dir.."/"
  elseif disk.isPresent("front") and not disk.hasAudio("front") then
   dir = disk.getMountPath("front")
   dir = dir.."/"
  end
  if rosloging then
   roslog.writeLine(shell.getRunningProgram()..": executing: '/ReboOSt/fbrws --dir "..dir.."'")
  end
  shell.run("/ReboOSt/fbrws", "--dir "..dir)
  if rosloging then
   roslog.writeLine("ReboOSt/fbrws: going back to mainframe")
  end
  dir = nil
  Desk()
 end

elseif X >= diskXmin and X <= diskXmax and Y >= 4 and Y <= 8 and button == 2 then
 if disk.isPresent("bottom") and not disk.hasAudio("bottom") or disk.isPresent("top") and not disk.hasAudio("top") or disk.isPresent("right") and not disk.hasAudio("right") or disk.isPresent("left") and not disk.hasAudio("left") or disk.isPresent("back") and not disk.hasAudio("back") or disk.isPresent("front") and not disk.hasAudio("front") then
 rightclickdiskX = X
 rightclickdiskY = Y
 shell.run("/ReboOSt/cntxmnudi")
 rightclickdiskX = nil
 rightclickdiskY = nil
 Desk()
 end

 -- Program Folder

elseif X >= pfolXmin and X <= pfolXmax and Y >= 4 and Y <= 8 then
 if pfolder then
  if rosloging then
   roslog.writeLine(shell.getRunningProgram()..": executing: '/ReboOSt/fbrws --dir /Programs'")
  end
  shell.run("/ReboOSt/fbrws", "--dir /Programs")
  if rosloging then
   roslog.writeLine("ReboOSt/fbrws: going back to mainframe")
  end
  Desk()
 end
end end
else
 term.setTextColor(16384)
 term.setBackgroundColor(32768)
 print("You don't even have ReboOSt started!")
 term.setTextColor(1)
end
