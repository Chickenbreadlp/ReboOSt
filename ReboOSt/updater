local inet = nil

local function get(paste)
    local response = http.get(
        "http://pastebin.com/raw.php?i="..textutils.urlEncode( paste )
    )
        
    if response then
        local sResponse = response.readAll()
        response.close()
        return sResponse
    else
    end
end
local function download(pastecode, sFile)
    local sPath = shell.resolve( sFile )
    if fs.exists( sPath ) then
        return
    end
    
    -- GET the contents from pastebin
    local res = get(pastecode)
    if res then        
        local file = fs.open( sPath, "w" )
        file.write( res )
        file.close()
    end
end

if login then
 term.setBackgroundColor(wico)
 term.setTextColor(wicotxt)
 term.setCursorPos(14,7)
 print("        Updater        ")
 term.setBackgroundColor(wicotxt)
 term.setTextColor(wico)
 term.setCursorPos(14,8)
 print("                       ")
 term.setCursorPos(14,9)
 print("Cheking for Internet...")
 term.setCursorPos(14,10)
 print("                       ")
 term.setCursorPos(14,11)
 print("                       ")
end
local inet = get("tUajHSeB")
if inet then
 if login then
  term.setCursorPos(21,10)
  print("Success!")
  sleep(2.5)
 end

if fs.exists("/ReboOSt/Temp/updater2") then
 fs.delete("/ReboOSt/Temp/updater2")
end
download("tUajHSeB", "/ReboOSt/Temp/updater2")
if fs.exists("/ReboOSt/Temp/updater2") then

--[[local file = fs.open("/ReboOSt/Temp/updater2", "r")
local fileData = {}
local line = file.readLine()
table.insert(fileData,line)
file.close()
local NewOSver = fileData[1]
]]
shell.run("/ReboOSt/Temp/updater2")


if rosbuildo <= rosbuild then
 if login then
  local loop = "on"
  term.setBackgroundColor(mbar)
  term.clear()
  term.setCursorPos(1,1)
  term.setBackgroundColor(tbar)
  term.setTextColor(tbartxt)
  print("                                                   ")
  term.setCursorPos(1,1)
  term.setBackgroundColor(mbar)
  term.setTextColor(mbartxt)
  write(OStag)
  term.setBackgroundColor(tbar)
  if rosdebug then
   term.setTextColor(colors.red)
   print(" "..devpart.." "..version)
  else
   term.setTextColor(tbartxt)
   print(" "..devpart.." "..version)
  end
  term.setCursorPos(44,1)
  term.setTextColor(prog)
  print("Updater ")
  term.setBackgroundColor(mbar)
  term.setTextColor(mbartxt)
  print(" ")
  print("There is no new Version available!")
  print(" ")
 if login then
  print("You will get back to the Desk in any second.")
 else
  print("You will get to the login any second.")
 end
  sleep(3)
 end
 fs.delete("/ReboOSt/Temp/updater2")
elseif rosbuildo > rosbuild then
--[[function  Laden()
 term.setCursorPos(19,7)
 print("Please wait |")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait /")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait -")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait |")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait /")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait -")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait |")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait /")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait -")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait |")
 sleep(0,1)
end]]

term.setBackgroundColor(mbar)
term.clear()
term.setCursorPos(1,1)
term.setBackgroundColor(tbar)
term.setTextColor(tbartxt)
print("                                                   ")
term.setCursorPos(1,1)
term.setBackgroundColor(mbar)
term.setTextColor(mbartxt)
write(OStag)
term.setBackgroundColor(tbar)
if rosdebug then
 term.setTextColor(colors.red)
 print(" "..devpart.." "..version)
else
 term.setTextColor(tbartxt)
 print(" "..devpart.." "..version)
end
term.setCursorPos(44,1)
term.setTextColor(prog)
print("Updater ")
term.setBackgroundColor(mbar)
term.setTextColor(mbartxt)
print(" ")
print("There is a new Version available.                  ")
print(" ")
print(" ")
print(" ")
print(" ")
print("Please manually download Build "..rosbuildo)
--[[print("Do you want to update?                             ")
print(" ")
term.setCursorPos(5,11)
term.setBackgroundColor(wicotxt)
term.setTextColor(wico)
print("                    ")
term.setCursorPos(5,12)
print("        Yes         ")
term.setCursorPos(5,13)
print("                    ")
term.setCursorPos(5,14)
print("        [X]         ")
term.setCursorPos(5,15)
print("                    ")
term.setCursorPos(27,11)
print("                    ")
term.setCursorPos(27,12)
print("        No          ")
term.setCursorPos(27,13)
print("                    ")
term.setCursorPos(27,14)
print("        [X]         ")
term.setCursorPos(27,15)
print("                    ")

while true do
local event, button, X, Y = os.pullEvent("mouse_click")
XY = X..","..Y

if XY == "14,14" and button == 1 then
 term.setBackgroundColor(mbar)
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(tbar)
 term.setTextColor(tbartxt)
 print("                                                   ")
 term.setCursorPos(1,1)
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 write(OStag)
 term.setBackgroundColor(tbar)
 term.setTextColor(tbartxt)
 print(" "..devpart.." "..version)
 term.setCursorPos(44,1)
 term.setTextColor(prog)
 print("Updater ")
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 print(" ")
 print("There is a new Version available. And you want to  ")
 print(" update. This will be deleting any custom mods.    ")
 print(" ")
 print(" ")
 print(" ")
 term.setCursorPos(1,18)
 term.setTextColor(sndtxt)
 print("                 Preparing Setup!                  ")
 term.setTextColor(mbartxt)
 sleep(3.5)
 term.setBackgroundColor(mbar)
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(tbar)
 term.setTextColor(tbartxt)
 print("                                                   ")
 term.setCursorPos(1,1)
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 write(OStag)
 term.setBackgroundColor(tbar)
 term.setTextColor(tbartxt)
 print(" "..devpart.." "..version)
 term.setCursorPos(44,1)
 term.setTextColor(prog)
 print("Updater ")
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 print(" ")
 print("ApfelOS 1.0 Pro is now updating.                   ")
 print(" ")
 print("Downloading OS...")
 
 download("VMD4n1tb", "/ReboOSt/Temp/updater1")
 shell.run("/ReboOSt/Temp/updater1")
 fs.delete("/ReboOSt/Temp/updater1")
 
 term.setBackgroundColor(mbar)
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(tbar)
 term.setTextColor(tbartxt)
 print("                                                   ")
 term.setCursorPos(1,1)
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 write(OStag)
 term.setBackgroundColor(tbar)
 term.setTextColor(tbartxt)
 print(" "..devpart.." "..version)
 term.setCursorPos(44,1)
 term.setTextColor(prog)
 print("Updater ")
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 print(" ")
 print("ReboOSt is now updating.                           ")
 Laden()
 Laden()
 Laden()
 Laden()
 term.setBackgroundColor(mbar)
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(tbar)
 term.setTextColor(tbartxt)
 print("                                                   ")
 term.setCursorPos(1,1)
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 write(OStag)
 term.setBackgroundColor(tbar)
 term.setTextColor(tbartxt)
 print(" "..devpart.." "..version)
 term.setCursorPos(44,1)
 term.setTextColor(prog)
 print("Updater ")
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 print(" ")
 print("ReboOSt is now on the newest Version.              ")
 print("The system will be rebooting any second.           ")
 fs.delete("Setup")
 sleep(3)
 fs.delete("/ReboOSt/Temp/updater2")
 os.reboot()
break
end

if XY == "36,14" and button == 1 then
 term.setBackgroundColor(mbar)
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(tbar)
 term.setTextColor(tbartxt)
 print("                                                   ")
 term.setCursorPos(1,1)
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 write(OStag)
 term.setBackgroundColor(tbar)
 term.setTextColor(tbartxt)
 print(" "..devpart.." "..version)
 term.setCursorPos(44,1)
 term.setTextColor(prog)
 print("Updater ")
 term.setBackgroundColor(mbar)
 term.setTextColor(mbartxt)
 print(" ")
 print("You want to keep the old Version? Your decision!")
 if login then
  print("You will get back to the Desk in any second.")
 else
  print("You will get to the login any second.")
 end
 sleep(3)
 fs.delete("/ReboOSt/Temp/updater2")
break
end end]]
end end
else
 if login then
  term.setCursorPos(15,10)
  print("Error! No Connection!")
  sleep(2.5)
 end
end
