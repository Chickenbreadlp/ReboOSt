local function get(paste)
    local response = http.get(
        "http://pastebin.com/raw.php?i="..textutils.urlEncode( paste )
    )
        
    if response then
        local sResponse = response.readAll()
        response.close()
        return sResponse
    else
    end
end
local function download(pastecode, sFile)
    local sPath = shell.resolve( sFile )
    if fs.exists( sPath ) then
        return
    end
    
    -- GET the contents from pastebin
    local res = get(pastecode)
    if res then        
        local file = fs.open( sPath, "w" )
        file.write( res )
        file.close()
    end
end

function  Laden()
 term.setCursorPos(19,7)
 print("Please wait |")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait /")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait -")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait |")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait /")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait -")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait |")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait /")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait -")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please wait |")
 sleep(0,1)
end

function InstallingBack()
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(2048)
 print("ApfelOS 1.0 Pro Installation                       ")
 term.setBackgroundColor(8)
 print(" ")
 print("ApfelOS 1.0 Pro is now repairing.                  ")
 print(" ")
 print("Downloading OS...")
 write("Starting Download for: ")
end

term.clear()
term.setCursorPos(1,1)
term.setBackgroundColor(2048)
print("                                                   ")
term.setBackgroundColor(8)
print("                                                   ")
term.clear()
term.setCursorPos(1,1)
term.setBackgroundColor(2048)
term.setTextColor(1)
print("ApfelOS 1.0 Pro Installation                       ")
term.setBackgroundColor(8)
print(" ")
print("You want to repair ApfelOS. This delete any custom ")
print(" mod which you have installed.                     ")
print(" ")
print(" ")
print(" ")
print("Are you sure?                                      ")
print(" ")
term.setCursorPos(5,11)
term.setBackgroundColor(1)
term.setTextColor(2048)
print("                    ")
term.setCursorPos(5,12)
print("        Yes         ")
term.setCursorPos(5,13)
print("                    ")
term.setCursorPos(5,14)
print("        [X]         ")
term.setCursorPos(5,15)
print("                    ")
term.setCursorPos(27,11)
print("                    ")
term.setCursorPos(27,12)
print("        No          ")
term.setCursorPos(27,13)
print("                    ")
term.setCursorPos(27,14)
print("        [X]         ")
term.setCursorPos(27,15)
print("                    ")

while true do
local event, button, X, Y = os.pullEvent("mouse_click")
XY = X..","..Y

if XY == "14,14" and button == 1 then
 term.setBackgroundColor(8)
 term.clear()
 term.setCursorPos(1,1)
 term.setTextColor(1)
 term.setBackgroundColor(2048)
 print("ApfelOS 1.0 Pro Installation                       ")
 term.setBackgroundColor(8)
 print(" ")
 print("You want to repair ApfelOS. This delete any custom ")
 print(" mod which you have installed.                     ")
 print(" ")
 print(" ")
 term.setCursorPos(1,18)
 term.setTextColor(16)
 print("                 Preparing Setup!                  ")
 term.setTextColor(1)
 sleep(6.5)
 term.setBackgroundColor(8)
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(2048)
 print("ApfelOS 1.0 Pro Installation                       ")
 term.setBackgroundColor(8)
 print(" ")
 print("ApfelOS 1.0 Pro is now repairing.                  ")
 
 if fs.exists("ApfelOS/..Benutzer") then
  fs.makeDir("Setup/Backup")
  fs.copy("ApfelOS/..Benutzer", "Setup/Backup/..Benutzer")
 end
 if fs.exists("Pictures") then
  fs.makeDir("Setup/Backup")
  fs.copy("Pictures", "Setup/Backup/Pictures")
  fs.delete("Pictures")
 end
 if fs.exists("ApfelOS/..colortheme.ac") then
  fs.makeDir("Setup/Backup")
  fs.copy("ApfelOS/..colortheme.ac", "Setup/Backup/..colortheme.ac")
 end
 if fs.exists("startup") then
  fs.delete("startup")
 end
 if fs.exists("Start.aef") then
  fs.delete("Start.aef")
 end
 if fs.exists("..boot.blf") then
  fs.delete("..boot.blf")
 end
 if fs.exists("ApfelOS") then
  fs.delete("ApfelOS")
 end
 fs.makeDir("ApfelOS")
 InstallingBack()
 print("startup")
 download("gd8pEebD", "startup")
 InstallingBack()
 print("Bootloader File")
 download("FbW7C2Z1", "..boot.blf")
 InstallingBack()
 print("ApfelOS/shell.adf")
 download("bn89FY5E", "ApfelOS/shell.adf")
 InstallingBack()
 print("Desktop")
 download("RdejfS8t", "ApfelOS/..Desk.adf")
 InstallingBack()
 print("Registartion")
 download("4zc5mE9K", "ApfelOS/..Regist.adf")
 InstallingBack()
 print("Welcome Routine")
 download("xSSzJNmU", "ApfelOS/..Welcome.adf")
 InstallingBack()
 print("About Page")
 download("bJxes5Rn", "ApfelOS/aInfo.adf")
 InstallingBack()
 print("Login Routine")
 download("zSARBabX", "ApfelOS/aLogin.adf")
 InstallingBack()
 print("ApfelOS/aTime.adf")
 download("WyaFHUfd", "ApfelOS/aTime.adf")
 InstallingBack()
 print("Error screen")
 download("dqqQmbX8", "ApfelOS/Error.abf")
 InstallingBack()
 print("Ice-Browser")
 download("SLQxa1xY", "ApfelOS/ice-browser.adf")
 InstallingBack()
 print("ApfelOS/shut-off.adf")
 download("wVNzkSbc", "ApfelOS/shut-off.adf")
 InstallingBack()
 print("luaIDE")
 download("vyAZc6tJ", "ApfelOS/luaIDE.adf")
 InstallingBack()
 print("Colortheme: Sky")
 download("csWJYYJA", "ApfelOS/..colortheme.ac")
 InstallingBack()
 print("ApfelOS/reboot.adf")
 download("3hbB09yX", "ApfelOS/reboot.adf")
 InstallingBack()
 print("Updater")
 download("i0QM8eC3", "ApfelOS/updater.adf")
 InstallingBack()
 print("Background")
 download("MUEcV8MR", "ApfelOS/background.nfp")
 InstallingBack()
 print("Theme Changer")
 download("bihxqhNa", "ApfelOS/thmchg.adf")
 InstallingBack()
 print("Colortheme: Demo")
 download("tRADXLG2", "colortheme.ac")
 InstallingBack()
 print("Logo")
 download("tCqSHVLR", "ApfelOS/logo.nfp")
 InstallingBack()
 print("ApfelOS/sysmnu.adf")
 download("cYJ9uykQ", "ApfelOS/sysmnu.adf")
 InstallingBack()
 print("ApfelOS/fsmnu.adf")
 download("gQnNhSdk", "ApfelOS/fsmnu.adf")
 InstallingBack()
 print("ApfelOS/devmnu.adf")
 download("PjcncZg6", "ApfelOS/devmnu.adf")
 InstallingBack()
 if fs.exists("Setup/Backup/..Benutzer") then
  fs.copy("Setup/Backup/..Benutzer", "ApfelOS/..Benutzer")
  if not fs.exists("Setup/Backup/Pictures") then
   fs.delete("Setup/Backup")
  end
 end
 fs.makeDir("ApfelOS/..Benutzer")
 fs.makeDir("ApfelOS/..Benutzer/root")
 fs.makeDir("ApfelOS/..Benutzer/root/..PC1299")
 if fs.exists("Setup/Backup/Pictures") then
  fs.copy("Setup/Backup/Pictures", "Pictures")
  fs.delete("Setup/Backup")
 end
 if not fs.exists("Pictures/sketch.adf") then
  fs.makeDir("Pictures")
  print("Sketch")
  download("Mm5hd97E", "Pictures/sketch.adf")
 end
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(2048)
 print("ApfelOS 1.0 Pro Installation                       ")
 term.setBackgroundColor(8)
 print(" ")
 print("ApfelOS 1.0 Pro is now repairing.                  ")
 fs.makeDir("ApfelOS/..Session")
 Laden()
 Laden()
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(2048)
 print("ApfelOS 1.0 Pro Installation                       ")
 term.setBackgroundColor(8)
 print(" ")
 print("ApfelOS is now repaired.                           ")
 print("The system will be rebooting any second.           ")
 fs.delete("Setup")
 sleep(3)
 os.reboot()
break
end

if XY == "36,14" and button == 1 then
 term.setBackgroundColor(8)
 term.clear()
 term.setCursorPos(1,1)
 term.setTextColor(1)
 term.setBackgroundColor(2048)
 print("ApfelOS 1.0 Pro Installation                       ")
 term.setBackgroundColor(8)
 print(" ")
 print("You go now back to the Menu!                       ")
 sleep(3)
 shell.run("Setup/contrll.adf")
end end
