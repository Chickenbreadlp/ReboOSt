local function GitHubGet(branch)
    local gitPath = "/"
    local banch = branch or nil
    local URL = "https://api.github.com/repos/Chickenbreadlp/ReboOSt/contents/" .. (branch and "?ref=" or "") .. (branch or "")
    local removeLuaExtention = true
    
    function getFileDownloadURLs(url, gatheredFiles, gatheredDirectories)
        assert(url, "url invalid")
        local handle = assert(http.get(url), "Getting " .. url .. " failed")
        local json = assert(handle.readAll(), "Reading failed for url " .. url)
        json = json:gsub("%s*\n%s*", "") --removes white space around '\n' and '\n'
        json = json:gsub("\"([^\"]*)\"%s*:%s*", "%1 = ") --turns '"hi": ' into 'hi = '
        json = json:sub(2, #json - 1) --removes brackets around the almostJSON
        json = "{" .. json .. "}" --adds curly brackets
        local jsonTable = assert(textutils.unserialize(json), "Failed to unserialize:\n" .. json)
        local files = gatheredFiles or {}
        local directories = gatheredDirectories or {}
        for k, v in ipairs(jsonTable) do
            if v.type == "file" then
                files[#files + 1] = {url = v.download_url, path = v.path}
            elseif v.type == "dir" then
                directories[#directories + 1] = v.url
            end
        end
        local recursiveURL = directories[1]
        if not recursiveURL then
            return files
        end
        if recursiveURL then
            table.remove(directories, 1)
            return getFileDownloadURLs(recursiveURL, files, directories)
        end
    end

    for k, v in ipairs(getFileDownloadURLs(URL)) do
        if (v.path:sub(#v.path - 3) == ".lua") and removeLuaExtention then
            v.path = v.path:sub(1, #v.path - 4)
        end
        local writeFile = fs.open("/" .. v.path, "w")
        local webHandle = assert(http.get(v.url), "Getting " .. v.url .. " failed")
        local webContents = assert(webHandle.readAll(), "Reading " .. v.url .. " failed")
        writeFile.write(webContents)
        writeFile.close()
    end
end

function  Laden()
 term.setCursorPos(19,7)
 print("Please Wait  |")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please Wait  /")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please Wait  -")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please Wait  |")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please Wait  /")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please Wait  -")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please Wait  |")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please Wait  /")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please Wait  -")
 sleep(0.1)
 term.setCursorPos(19,7)
 print("Please Wait  |")
 sleep(0,1)
end

function InstallingBack()
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(2048)
 print("ReboOSt Installation                               ")
 term.setBackgroundColor(8)
 print(" ")
 print("ReboOSt is now installing!")
 print(" ")
 print("Downloading OS...")
end

term.setBackgroundColor(8)
print("                                                   ")
term.clear()
term.setCursorPos(1,1)
term.setBackgroundColor(2048)
term.setTextColor(1)
print("ReboOSt Installation                               ")
term.setBackgroundColor(8)
print(" ")
print("You want to install ReboOSt!                       ")
print(" If you have already an other OS installed, it is  ")
print(" recommend to uninstall it, before installing      ")
print(" ReboOSt or any other OS.                          ")
print(" ")
print("Are you sure?                                      ")
print(" ")
term.setCursorPos(5,11)
term.setBackgroundColor(1)
term.setTextColor(2048)
print("                    ")
term.setCursorPos(5,12)
print("        Yes         ")
term.setCursorPos(5,13)
print("                    ")
term.setCursorPos(5,14)
print("        [X]         ")
term.setCursorPos(5,15)
print("                    ")
term.setCursorPos(27,11)
print("                    ")
term.setCursorPos(27,12)
print("        No          ")
term.setCursorPos(27,13)
print("                    ")
term.setCursorPos(27,14)
print("        [X]         ")
term.setCursorPos(27,15)
print("                    ")

while true do
local event, button, X, Y = os.pullEvent("mouse_click")
XY = X..","..Y

if XY == "14,14" and button == 1 then
 term.setBackgroundColor(8)
 term.clear()
 term.setCursorPos(1,1)
 term.setTextColor(1)
 term.setBackgroundColor(2048)
 print("ReboOSt Installation                               ")
 term.setBackgroundColor(8)
 print(" ")
 print("You want to install ReboOSt!                       ")
 print(" If you have already an other OS installed, it is  ")
 print(" recommend to uninstall it, before installing      ")
 print(" ReboOSt or any other OS.                          ")
 term.setCursorPos(1,18)
 term.setTextColor(16)
 print("                 Preparing Setup!                  ")
 term.setTextColor(1)
 sleep(3.5)
 
 if fs.exists("ReboOSt") then
  fs.delete("ReboOSt")
 end
 
 if fs.exists("Programs") then
  fs.delete("Programs")
 end
 
 if fs.exists("User") then
  fs.delete("User")
 end
 
 if fs.exists("startup") then
  fs.delete("startup")
 end

 if fs.exists("Start") then
  fs.delete("Start")
 end
 
 InstallingBack()
 GitHubGet(nil)
 term.clear()
 term.setCursorPos(1,1)
 term.setBackgroundColor(2048)
 print("ReboOSt Installation                               ")
 term.setBackgroundColor(8)
 print(" ")
 print("ReboOSt is now ready to go!                        ")
 sleep(2.5)
 shell.run("Setup/shut-off")
break
end

if XY == "36,14" and button == 1 then
 term.setBackgroundColor(8)
 term.clear()
 term.setCursorPos(1,1)
 term.setTextColor(1)
 term.setBackgroundColor(2048)
 print("ApfelOS 1.0 Pro Installation                       ")
 term.setBackgroundColor(8)
 print(" ")
 print("You go now back to the Menu!                       ")
 sleep(3)
 shell.run("Setup/contrll")
end end
